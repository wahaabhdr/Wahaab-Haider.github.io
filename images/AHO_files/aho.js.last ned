var typeOfFilter = '';
var paramOfFilter = "";
var lastClick = 0;
(function (jav)
{
    Drupal.behaviors.responsiveBartikCollapsibleMenu = {
        attach: function (context, settings)
        {
            
            jav('.toggle-menu').click(function ()
            {
                //++ fix the hamburger menu suddenly starts moving up and down when editing landing page then click on menu
                var bodyClass = jav('body').attr("class");
                if (bodyClass.indexOf('not-front') !== -1){
                    if ((Date.now() - lastClick) > 500 ){
                        lastClick = Date.now();
                        jav('#menu').slideToggle(200);
                        jav('body').toggleClass('sf');
                        jav('body').toggleClass('mw-js-overlay-active');

                        var type = Browser.detectBrowser();
                        if (jav('body').hasClass('closesearchform')) {
                            jav('body').removeClass('closesearchform');
                            jav("div.popup-dialog").remove();
                            if (type === 1) {
                                jav("#slideshow").show();
                                jav("#main-wrapper").show();
                                jav("#content-bottom").show();
                                jav("ul.nav-tabs").show();
                            }
                        }
                    }
                } else {
                    jav('#menu').slideToggle(200);
                    jav('body').toggleClass('sf');
                    jav('body').toggleClass('mw-js-overlay-active');

                    var type = Browser.detectBrowser();
                    if (jav('body').hasClass('closesearchform')) {
                        jav('body').removeClass('closesearchform');
                        jav("div.popup-dialog").remove();
                        if (type === 1) {
                            jav("#slideshow").show();
                            jav("#main-wrapper").show();
                            jav("#content-bottom").show();
                            jav("ul.nav-tabs").show();
                        }
                    }
                }
                
                //--
                
                
            });

            //toggle mobile book page
            jav('#block-chapter h3').click(function () {
                jav(this).next('.content').slideToggle(200);
                jav(this).toggleClass('active');
            });

            //scrolltop
            jav('.scrollTop').click(function () {
                jav("html, body").animate({scrollTop: 0}, 600);
                return false;
            });

            // slide home page
            // jav('#block-views-slide-home-block .views-row-1 img, #block-views-slide-home-block .views-row-2 img, #block-views-slide-home-block .views-row-3 img').hide();
            // jav('#block-views-slide-home-block .category-name').hover(function () {
            //     jav('#block-views-slide-home-block .views-row img').hide();
            //     jav(this).next('a').find('img').show();
            //     jav('#block-views-slide-home-block .view-header img').hide();
            // });
            // jav('#block-views-slide-home-block .category-name').mouseleave(function () {
            //     jav('#block-views-slide-home-block .view-header img').show();
            //     jav('#block-views-slide-home-block .views-row-1 img, #block-views-slide-home-block .views-row-2 img, #block-views-slide-home-block .views-row-3 img').hide();
            // });
            // change text in language
            jav('.language-switcher-locale-url li.en a').html('en');
            jav('.language-switcher-locale-url li.nb a').html('no');

            
            
            if (jav(window).width() > 990) {
                imagesLoaded('#project-slideshow .caroufredsel', function () {
                    var h = jav('#project-slideshow .caroufredsel img').height();
                    jav('.top-article-pj').css('min-height', h);
                });
            }

            jav(window).resize(function () {
                if (jav(window).width() > 990) {
                    imagesLoaded('#project-slideshow .caroufredsel', function () {
                        var h = jav('#project-slideshow .caroufredsel img').height();
                        
                        jav('.top-article-pj').css('min-height', h);
                    });
                } else {
                    jav('.top-article-pj').removeAttr('style');
                }
                if (jav('#slide-top').length) {
                    jav('.caroufredsel-inner img').height('auto');
                    var carousel = jav('.caroufredsel-inner');
                    var min_height = carousel.children().first().height();
                    carousel.children().each(function () {
                        if (min_height > jav(this).height())
                            min_height = jav(this).height();
                    });
                    carousel.carouFredSel({
                        infinite: true,
                        responsive: true,
                        height: min_height,
                        items: {
                            visible: 1 //  automatically calculated
                        },
                        onCreate: function () {
                            var min_height = carousel.children().first().height();
                            carousel.children().each(function () {
                                if (min_height > jav(this).height())
                                    min_height = jav(this).height();
                            });
                            carousel.parent().add(carousel).css('height', min_height + 'px');
                        },
                        auto: {
                            play: false
                        },
                        scroll: {
                            items: 1,
                            fx: "crossfade",
                            onBefore: function () {
                                var min_height = carousel.children().first().height();
                                carousel.children().each(function () {
                                    if (min_height > jav(this).height())
                                        min_height = jav(this).height();
                                });
                                carousel.parent().add(carousel).css('height', min_height + 'px');
                            }
                        },
                        prev: '.left',
                        next: '.right',
                        pagination: '.caroufredsel-indicators',
                        swipe: {
                            onTouch: true,
                            onMouse: true
                        }
                    });

                    if (jav('#slide-top').width() >= 2000) {
                        var arrow_left = jav('#slide-top').width() / 2 - 1000;
                        jav('#slide-top a.left').css({'left': arrow_left});
                        jav('#slide-top a.right').css({'right': arrow_left});
                    } else {
                        jav('#slide-top a.left').css({'left': 0});
                        jav('#slide-top a.right').css({'right': 0});
                    }
                }

                if (jav('.caroufredsel').length) {
                    jav(".caroufredsel").carouFredSel({
                        infinite: true,
                        responsive: true,
                        items: {
                            visible: 1 //  automatically calculated
                        },
                        auto: {
                            play: false
                        },
                        scroll: {
                            items: 1,
                            fx: "crossfade",
                            onAfter: function () {
                                jav(this).trigger("currentPosition", function (pos) {
                                    var txt = "<p>" + (pos + 1) + " of " + jav("> *", this).length + "</p>";
                                    jav(".count-item").html(txt);
                                });
                            }
                        },
                        prev: '.left',
                        next: '.right',
                        swipe: {
                            onTouch: true,
                            onMouse: true
                        }
                    });
                }

                if (jav('body').hasClass('page-home')) {
                    imagesLoaded('#block-mymodule-myblock', function () {
                        //console.log(jQuery(window).width()+" x "+jQuery(window).height());
                        /*++++*/
                        var standardRatio = 1.75;
                        var w = jQuery(window).width(),
                            h = jQuery(window).height();
                        if (h > 0){
                            var offset = standardRatio - w/h;
                            offset = offset.toFixed(4);
                            if (offset > 0){
                                if (offset > 0.39){
                                    var imgWidth = Math.round(100 + offset*80);
                                } else if (offset > 0.22){
                                    var imgWidth = Math.round(100 + offset*70);
                                } else {
                                    var imgWidth = Math.round(100 + offset*60);
                                }

                                imgWidth += '%';
                                //console.log(imgWidth);

                                jav('#block-mymodule-myblock img').css({'width': imgWidth, 'max-width': imgWidth});
                            }
                            //console.log(offset);
                        }
                        /*----*/
                        if (jav(window).width() < 1024){

                        if(jav(window).width() <= 640)
                            var header_height = jav('header').height();
                        else
                            var header_height = jav('header').height() + 90;
                        
                        if (jav('#navbar-bar').height() > 0)
                            header_height = header_height + 213;
                        
                        var slideshow_height = jav(window).height() - header_height;
                        //slideshow_height = 700;

//                            if (slideshow_height > 750){
//                                slideshow_height = 750;
//                            }
//                            if (slideshow_height < 650){
//                                slideshow_height = 650;
//                            }

                        //++ additional check for short screen
//                            var lineHeightIsChanged = false;
//                            var currentLineHeight = jQuery('#block-mymodule-myblock .title h2').css('line-height');
//                            if (jQuery(window).width() > 922){
//                                var screenHeight = jQuery(window).height();
//                                if (screenHeight < 845 && screenHeight > 590){
//                                    var newLineHeight = '70px';
//                                    if (screenHeight > 750){
//                                        slideshow_height = 530;
//                                        newLineHeight = '85px';
//                                    } else if (screenHeight > 640){
//                                        slideshow_height = 445;
//                                    } else if (screenHeight > 590){
//                                        slideshow_height = 395;
//                                    }
//                                    jQuery('#block-mymodule-myblock .title h2').css({'line-height': newLineHeight});
//                                    lineHeightIsChanged = true;
//                                }
//                            }
//                            if (lineHeightIsChanged === false){
//                                if (currentLineHeight == '70px' || currentLineHeight == '85px'){
//                                    currentLineHeight = '110px';
//                                }
//                                jQuery('#block-mymodule-myblock .title h2').css({'line-height': currentLineHeight});
//                            }

                        //--
                        
                        jav('#slideshow').height(slideshow_height);
                        jav('#block-mymodule-myblock').height(slideshow_height);

                        jav('#block-mymodule-myblock img').css({'height': slideshow_height, 'width': 'auto', 'max-width': 'none'});
                        if (jav('#block-mymodule-myblock img').width() < jav('#block-mymodule-myblock').width())
                            jav('#block-mymodule-myblock img').css({'height': 'auto', 'width': '100%', 'max-width': '100%'});
                        } else {
                            //jav('#block-mymodule-myblock img').css({'height': 'auto', 'width': 'auto', 'max-width': 'none'});
                        }
                        jav('#loading').remove();
                    });
                }
            });

            jav('#block-mymodule-myblock .title h2').mouseenter(function () {
                jav('.img > img').hide();
                var dtim = jav(this).attr('data-img');
                var t = '.homepage-slideshow-' + dtim;
                jav('img').removeClass('show');
                jav(t).addClass('show');
            });
            jav('#block-mymodule-myblock .title h2').mouseleave(function () {
                jav('.img > img').fadeIn();
                jav('img').removeClass('show');
            });

            jav('.list-filter-block h3').click(function () {
                jav(this).toggleClass('active');
                jav(this).next('.list-filter').slideToggle(200);
            });

            var total = jav('.wrap-content-slide .caroufredsel .item').length;
            var txt = "<p>1 of " + total + "</p>";
            jav(".count-item").html(txt);

            if (jav('#slide-top').width() >= 2000) {
                var arrow_left = jav('#slide-top').width() / 2 - 1000;
                jav('#slide-top a.left').css({'left': arrow_left});
                jav('#slide-top a.right').css({'right': arrow_left});
            } else {
                jav('#slide-top a.left').css({'left': 0});
                jav('#slide-top a.right').css({'right': 0});
            }
        }
    };

    String.prototype.replaceAll = function (find, replace) {
        var str = this;
        return str.replace(new RegExp(find.replace(/[-\/\\^jav*+?.()|[\]{}]/g, '\\jav&'), 'g'), replace);
    };
    hook_users = {
        rm_hook: false,
        lang_code: (jQuery(location).attr('href').indexOf('/en/') !== -1) ? 'en' : 'no',
        def_ldap_disabled: ['name', 'mail', 'field_name', 'field_firstname', 'field_lastname', 'field_name_to_be_shown', 'field_mobile_number', 'field_title_no', 'field_title_en', 'field_telephone', 'field_org_department_en', 'field_org_department_no', 'field_mail_address'],
        tab: function ()
        {
            if (this.rm_hook)
                return false;

            if (jav('#user-profile-form').length || jav('.pane-user-field-picture-high-resolution').length || jav('.pane-user-picture').length || jav('#user-panel').length)
            {
                jav(".tabs li:nth-child(2) a ").html('English');
                url = jav(".tabs li:nth-child(2) a").attr('href');
                if (jav(".tabs li:nth-child(2) a").length)
                {
                    jav(".tabs li:nth-child(2)").after('<li><a href="' + url.replace('/en/', '/no/') + '">Norsk</a></li>');
                    jav(".tabs li:nth-child(2) a").attr('href', jav(".tabs li:nth-child(2) a ").attr('href').replace('/no/', '/en/'));

                    if (jQuery(location).attr('href').indexOf('/no/') !== -1 && jQuery(location).attr('href').indexOf('/edit') !== -1)
                    {
                        jav(".tabs li:nth-child(3)").addClass("active");
                        jav(".tabs li:nth-child(2)").removeClass("active");

                        jav(".tabs li:nth-child(3) a").addClass("active");
                        jav(".tabs li:nth-child(2) a").removeClass("active");
                    }
                }
            }
        },
        view: function ()
        {
            if (this.rm_hook)
                return false;

            // hook to repair mobile number for user view
            panel = '.pane-user-';
            rm_hide_mobile_number = jav(panel + 'field-hide-mobile-number div div div div');
            if (jQuery.trim(rm_hide_mobile_number.html()) !== '')
            {
                jav(panel + 'field-telephone').remove();
            }
            jav(panel + 'field-hide-mobile-number').remove();

            obj = jav("#user-profile-form div div");
            obj = jav("#user-panel .pane-entity-field");

            obj.each(function ( )
            {
                //id = this.id;   

                id = jav(this).attr('class').split('pane-user-');
                id = id[1];

                if (id.indexOf('-no') !== -1 || id.indexOf('-en') !== -1)
                {
                    rm_id = id; //this.id;

                    if (jQuery(location).attr('href').indexOf('/en/') !== -1)
                    {
                        rm_id = rm_id.replace('-en', '-no');
                        jav(panel + rm_id).remove();
                    }
                    else if (jQuery(location).attr('href').indexOf('/no/') !== -1)
                    {
                        rm_id = rm_id.replace('-no', '-en');
                        jav(panel + rm_id).remove();
                    }
                    //console.log(rm_id);
                }
            });

//      Ảnh hưởng đến tất cả các trang khác khi Add text -> chỉ nên áp dụng với trang cần dùng
//      if (jav('.pane-bundle-text h2').length)
//      {
//        title = jav('.pane-bundle-text h2').html().split(':');
//        jav('.pane-bundle-text h2').html(title[0]);
//        jav('.pane-bundle-text .pane-content div').html(title[1])
//      }

            if (jav('.field-name-field-title-' + this.lang_code + ' div div').length && jQuery(location).attr('href').indexOf('/edit') === -1)
            {
                title = jav('.field-name-field-corrected-title-' + this.lang_code + ' div div').html();
                if (jQuery.trim(title) !== '')
                {
                    jav('.field-name-field-title-' + this.lang_code + ' div div').html(title);
                    jav('.pane-user-field-corrected-title-' + this.lang_code + '').hide();
                }
            }
            if (jav('.field-name-field-picture-with-high-resoluti a').length && jQuery(location).attr('href').indexOf('/edit') === -1)
            {
                jav('.field-name-field-picture-with-high-resoluti div div a').attr('target', '_blank');
                jav('.field-name-field-picture-with-high-resoluti div div a').html(jav('.field-name-field-picture-with-high-resoluti .field-label').html().replace(':', ''));
                jav('.field-name-field-picture-with-high-resoluti .field-label').remove();
            }
            if (jQuery(location).attr('href').indexOf('/edit') === -1)
            {
                jav('.pane-entity-field').each(function ( )
                {
                    cls_name = jav(this).attr('class').replace('panel-pane pane-entity-field ', '');
                    //console.log(cls_name);
                    //console.log(jav('.' + cls_name + ' div div div div').html());
                    if (jQuery.trim(jav('.' + cls_name + ' div div div div').html()) === '')
                        jav('.' + cls_name).remove();
                });
            }
        },
        form: function ()
        {
            //alert(tmp.toSource());
            if (this.rm_hook)
                return false;

            panel = 'panels-ipe-';
            obj = jav('#' + panel + 'regionid-contentmain .' + panel + 'sort-container .' + panel + 'portlet-wrapper');
            obj = jav('#user-profile-form div div');
            obj.each(function ( )
            {
                class_name = this.id;//jav('#' + this.id + ' .' + panel + 'portlet-content div').attr('class');

                //console.log(class_name)
                if (
                        (jQuery(location).attr('href').indexOf('/no/') !== -1 && class_name.indexOf('-en') !== -1) ||
                        (jQuery(location).attr('href').indexOf('/en/') !== -1 && class_name.indexOf('-no') !== -1)
                        ) {
                    jav('#' + this.id).hide();
                }
            });

            jav('#edit-locale').hide();
            jav('#edit-contact').hide();
            jav('#edit-timezone').hide();

            if (jav('.form-item-mail').length)
                jav('.form-item-name').before(jav('.form-item-mail').before());

            //console.log(jav.base64.decode(jav('#uproles').val()));
            /*
             ***
             erros home page no load after js
             ***
             */
            if (jav.base64.decode(jav('#uproles').val()).indexOf('Student') !== -1 && jQuery(location).attr('href').indexOf('/edit') !== -1)
            {
                //jav('.group-numberone').hide();
                jav.each(['numbertwo', 'groupthree'], function (ind, item)
                {
                    jav('.group-' + item + ' .fieldset-wrapper div').each(function ( )
                    {
                        if (this.id.indexOf('user-picture') === -1 && this.id.indexOf('area-of-expertise') === -1 && this.id.indexOf('introduction') === -1 && this.id.indexOf('related-projects') === -1)
                            jav('#' + this.id).hide();
                    });
                });
                jav('.group-fourth').hide();
            }

        },
        // Lock data from LDAP in user form
        disable: function ()
        {
            if (this.rm_hook)
                return false;

            class_item = '.form-item-';
            id_name = '#user-profile-form';
            if (jav(id_name).length)// && parseInt(jav.base64.decode(jav('#uldap').val())) == 1)
            {
                jav.each(this.def_ldap_disabled, function (ind, item)
                {
                    item = item.replaceAll('_', '-');
                    item += (item === 'name' || item === 'mail') ? '' : '-und-0-value';

                    jav(id_name + ' ' + class_item + item + ' label').after('&nbsp;&nbsp;<span id="txt-' + class_item.replace('.', '') + item + '">' + jav(id_name + ' #edit-' + item).val() + '</span>');
                    jav(id_name + ' ' + class_item + item + ' label').after('<strong>' + jav(id_name + ' ' + class_item + item + ' label').html() + ':</strong>');

                    jav(id_name + ' #edit-' + item).hide();//.remove();
                    jav(id_name + ' ' + class_item + item + ' label').hide();
                    jav(id_name + ' ' + class_item + item + ' .description').hide();
                    jav(id_name + ' ' + class_item + item + ' .form-required').hide();

                });
                jav(id_name + ' ' + class_item + 'current-pass').hide();
                jav(id_name + ' ' + class_item + 'pass').hide();
                //jav(class_item + 'roles').remove();
            }
        },
        setData: function (item, is_input)
        {
            obj = jav('#edit-field-' + item + '-en-und-0-value');
            el_en = (is_input) ? obj.val() : obj.html();

            obj = jav('#edit-field-' + item + '-no-und-0-value');
            el_no = (is_input) ? obj.val() : obj.html();

            if (jQuery.trim(el_no) === '')
            {
                el_en = this.decodeHtmlEntity(el_en);
                el_en = el_en.replaceAll('<p><p>', '<p>');
                el_en = el_en.replaceAll('</p></p>', '</p>');

                obj = jav('#edit-field-' + item + '-no-und-0-value');
                (is_input) ? obj.val(el_en) : obj.html(el_en);

                (is_input) ? '' : jav("#edit-field-" + item + "-no-und-0-value_ifr").contents().find("html").html(el_en);
            }
        },
        decodeHtmlEntity: function (str) {
            /*Firefox (and IE if the string contains no elements surrounded by angle brackets )*/
            try {
                var ta = document.createElement("textarea");
                ta.innerHTML = str;
                return ta.value;
            } catch (e) {
            }
            ;
            /*Internet Explorer*/
            try {
                var d = document.createElement("div");
                d.innerHTML = str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                if (typeof d.innerText !== "undefined")
                    return d.innerText;/*Sadly this strips tags as well*/
            } catch (e) {
            }
        },
        process: function ()
        {
            this.tab();
            this.view();
            this.form();
            this.disable();
        }
    };

    header = {
        searchresult: function () {
            var keyw = jav('.aho_ajaxsearchform input.textsearch').val();
            if (keyw === '') {
                jav(".result-search").html('<div style="padding:20px 0 0;font-size:14px"><ul>'
                        + '<li>Check if your spelling is correct, or try removing filters.</li>'
                        + '<li>Remove quotes around phrases to match each word individually: <em>"blue drop"</em> will match less than <em>blue drop</em>.</li>'
                        + '<li>You can require or exclude terms using + and -: <em>big +blue drop</em> will require a match on <em>blue</em> while <em>big blue -drop</em> will exclude results that contain <em>drop</em>.</li>'
                        + '</ul></div>');
                return;
            }

            var baseUrl = jav('#baseUrl').val();
            var type = Browser.detectBrowser();

            var uriRoot = baseUrl.replace("/en", "");
            uriRoot = uriRoot.replace("/no", "");

            var mobile_check = 1;
            if (type === 1) {
                mobile_check = 'mobile';
                jav("#slideshow").show();
                jav("#main-wrapper").show();
                jav("#content-bottom").show();
                jav("ul.nav-tabs").show();
            }

            jav(".result-search").html('<div style="padding:40px;text-align:center"><img src="' + uriRoot + '/sites/all/themes/AHO/images/loading.gif" /></div>');
            jav.ajax({
                url: baseUrl + "/aho-search/" + jav('.aho_ajaxsearchform input.textsearch').val() + '/' + mobile_check,
                type: "GET",
                cache: false
            })
                    .done(function (data) {
                        jav(".result-search").html(data);
                    });
        },
        getresult: function (url) {
            var baseUrl = jav('#baseUrl').val();
            var uriRoot = baseUrl.replace("/en", "");
            uriRoot = uriRoot.replace("/no", "");

            jav(".result-search").html('<div style="padding:40px;text-align:center"><img src="' + uriRoot + '/sites/all/themes/AHO/images/loading.gif" /></div>');
            jav.ajax({
                url: url,
                type: "GET",
                cache: false
            })
                    .done(function (data) {
                        jav(".result-search").html(data);
                        window.scrollTo(0, 0);
                    });
        },
        searchPeople: function (total) {
            var baseUrl = jav('#baseUrl').val();
            var uriRoot = baseUrl.replace("/en", "");
            uriRoot = uriRoot.replace("/no", "");
            var title_text = (jQuery(location).attr('href').indexOf('/en/') !== -1) ? 'People' : 'Personer';
            jav('.result-search .total_search').hide();
            jav("#slideshow").hide();
            jav("#main-wrapper").hide();
            jav("#content-bottom").hide();
            jav("ul.nav-tabs").hide();

            jav('.result-search-inner').html('<div class="aho-search-inner">'
                    + '<div class="row">'
                    + '<div class="col-md-5 people">'
                    + '<h2>' + title_text + ' <span>(' + total + ')</span></h2>'
                    + '<div id="content"></div>'
                    + '</div>'
                    + '</div>'
                    + '</div>');

            jav(document).ready(function () {
                jav('#content').scrollPaginationAjax({
                    type: 'people',
                    nop: 5, // The number of posts per scroll to be loaded
                    offset: 0, // Initial offset, begins at 0 in this case
                    error: '', // When the user reaches the end this is the message that is
                    // displayed. You can change this if you want.
                    delay: 500, // When you scroll down the posts will load after a delayed amount of time.
                    // This is mainly for usability concerns. You can alter this as you see fit
                    scroll: true // The main bit, if set to false posts will not load as the user scrolls. 
                            // but will still load if the user clicks.
                });
            });
        },
        searchArticles: function (total) {
            var baseUrl = jav('#baseUrl').val();
            var uriRoot = baseUrl.replace("/en", "");
            uriRoot = uriRoot.replace("/no", "");

            var title_text = (jQuery(location).attr('href').indexOf('/en/') !== -1) ? 'Articles' : 'Artikler';

            jav('.result-search .total_search').hide();
            jav("#slideshow").hide();
            jav("#main-wrapper").hide();
            jav("#content-bottom").hide();
            jav("ul.nav-tabs").hide();

            jav('.result-search-inner').html('<div class="aho-search-inner">'
                    + '<div class="row">'
                    + '<div class="col-md-5 people">'
                    + '<h2>' + title_text + ' <span>(' + total + ')</span></h2>'
                    + '<div id="content"></div>'
                    + '</div>'
                    + '</div>'
                    + '</div>');

            jav(document).ready(function () {
                jav('#content').scrollPaginationAjax({
                    type: 'articles',
                    nop: 5, // The number of posts per scroll to be loaded
                    offset: 0, // Initial offset, begins at 0 in this case
                    error: '', // When the user reaches the end this is the message that is
                    // displayed. You can change this if you want.
                    delay: 500, // When you scroll down the posts will load after a delayed amount of time.
                    // This is mainly for usability concerns. You can alter this as you see fit
                    scroll: true // The main bit, if set to false posts will not load as the user scrolls. 
                            // but will still load if the user clicks.
                });
            });
        },
        donpopup: function () {
            jav('div.popup-dialog').show();
            return false;
        },
        closepop: function () {
            jav('div.popup-dialog').hide();
        },
        profile: function ()
        {
            var languageLink = '';
            var newLanguageLink = '';
            jav("ul.language-switcher-locale-url li").each(function(){
               languageLink = jav(this).find('a').attr('href');
               if (languageLink.indexOf('/no/aho-staff/') !== -1){
                   newLanguageLink = languageLink.replace('/no/aho-staff/','/no/ansatt/');
                   jav(this).find('a').attr('href',newLanguageLink);
               }
               if (languageLink.indexOf('/en/ansatt/') !== -1){
                   newLanguageLink = languageLink.replace('/en/ansatt/','/en/aho-staff/');
                   jav(this).find('a').attr('href',newLanguageLink);
               }
            });
            return false;

            //if (jQuery(location).attr('href').indexOf('/employee/') !== -1) 
            //{
            baseUrl = jav('#baseUrl').val();

            pro_text = (jQuery(location).attr('href').indexOf('/en/') !== -1) ? 'Profile' : 'Profil';
            jav("ul.language-switcher-locale-url li:last").after('<li style="padding-left:12px"><a href="' + baseUrl + '/user/' + jav('#uid').val() + '/edit">' + pro_text + '</a></li>');
            //}
        },
        tab_menu_study_program: function ()
        {
            //get latest year
            var currentUrl = jQuery(location).attr('href');
            baseUrl = '';
            if (currentUrl.indexOf('/no/') !== -1) {
                baseUrl = currentUrl.split("/no/", 1);
                baseUrl = baseUrl[0];
            } else if (currentUrl.indexOf('/en/') !== -1) {
                baseUrl = currentUrl.split("/en/", 1);
                baseUrl = baseUrl[0];
            }

            if (baseUrl) {
                jQuery.get(baseUrl + '/study_plan.tmp', function (latestYear) {
                    if (!latestYear) {
                        latestYear = '2015';
                    }

                    jav.each(['ark', 'ide', 'ul'], function (ind, item)
                    {
                        cls_name = 'pane-menu-studies-' + item;
                        if (jav('.' + cls_name).length)
                        {
                            jav('.' + cls_name + ' h2').remove();
                            jav('.' + cls_name + ' div').removeClass("pane-content").addClass("tabs");
                            jav('.' + cls_name + ' ul').removeClass("menu").addClass("tabs primary");

                            li0 = jav('.' + cls_name + ' ul li:nth-child(1) a ');
                            var url0 = li0.prop('href');
                            var arrTmp = url0.split("/");
                            var spType = arrTmp[arrTmp.length - 1];

                            if (jQuery(location).attr('href').indexOf('/study-plan') !== -1)
                            {
                                jav('.' + cls_name + ' ul li:nth-child(2) ').attr('class', 'active leaf');
                            }
                        }
                    });

                }, 'text');
            }

        },
        init: function ()
        {
            jav('#block-locale-language .active').hide();
            this.profile();
            jav('#main-menu').hide();
            this.tab_menu_study_program();
        }
    };

    jav(function ()
    {
        if (jav('.node-enterprise-event').length)
        {
            id = jav('.node-enterprise-event').attr('id');
            cls = jav('.node-enterprise-event').attr('class');
            code = cls.indexOf(' nb ') !== -1 ? 'no' : 'en';

            url = jav('#baseUrl').val();
            url = url.replace('/en', '/' + code);
            url = url.replace('/nb', '/' + code);

            window.location = url + '/events/view/' + id.replace('node-', '') + '/1';
            //console.log( url + '/events/view/' + id.replace('node-', '') + '/1');
        }
        var redirect = '';
        if(jav.base64.decode(jav('#uroles').val()).indexOf('Student') !== -1)
            redirect = 'member/students';
        else if(jav.base64.decode(jav('#uroles').val()).indexOf('Employee') !== -1){
            if (jav('#baseUrl').val().indexOf('/en') !== -1){
                redirect = 'aho-staff';
            } else {
                redirect = 'ansatt';
            }
        }
          
        if (jav('#navbar-administration .menu .account a').length){
            if(redirect !== '')
                jav('#navbar-administration .menu .account a').attr('href', jav('#baseUrl').val() + '/' + redirect + '/' + jav('#username').val());
        }
        
        jav('#block-search-form span').click(function ()
        {
            var type = Browser.detectBrowser();
            if (jav('body').hasClass('closesearchform')) {
                jav('body').removeClass('closesearchform');
                jav("div.popup-dialog").remove();
                if (type === 1) {
                    jav("#slideshow").show();
                    jav("#main-wrapper").show();
                    jav("#content-bottom").show();
                    jav("ul.nav-tabs").show();
                }
            } else {
                jav('#menu').hide();
                jav('body').removeClass('mw-js-overlay-active');
                jav('body').addClass('closesearchform');

                if (type === 1) {
                    jav('header').after('<div class="popup-dialog mobile-ver"></div>');

                    jav('div.popup-dialog').css({'top': '0'});

                    jav('div.popup-dialog').html('<div class="container"><div class="aho_ajaxsearchform"><input class="textsearch" name="searchkw" type="text" onKeydown="Javascript: if (event.keyCode==13) header.searchresult();" /></div><div class="result-search"></div></div>');
                    jav('.aho_ajaxsearchform input.textsearch').css({'width': (jav('.container').width()) + 'px'});
                    header.donpopup();
                    jav('div.aho_ajaxsearchform input.textsearch').focus();
                    return;
                }

                jav('#page').append('<div class="popup-dialog"></div>');
                var header_height = jav('header').height();
                if (jav('#navbar-bar').height() > 0) {
                    if (jav('body').hasClass('page-home') || jav('#slideshow').height() > 10) {
                        header_height = header_height + 51;
                    }
                }
                var popup_dialog_height = jav('#page').height() - header_height;
                if (popup_dialog_height < 1500) {
                    popup_dialog_height = 1500;
                    jav('#page').css({'height': (popup_dialog_height + header_height) + 'px'});
                }
                jav('div.popup-dialog').css({'height': popup_dialog_height + 'px', 'top': header_height + 'px'});
                jav('div.popup-dialog').html('<div class="container"><div class="aho_ajaxsearchform"><input class="textsearch" name="searchkw" type="text" onKeydown="Javascript: if (event.keyCode==13) header.searchresult();" /><a class="button see-all" href="javascript:;" onclick="header.searchresult();">Search</a></div><div class="result-search"></div></div>');
                jav('.aho_ajaxsearchform input.textsearch').css({'width': (jav('.container').width() - 110) + 'px'});
                header.donpopup();
                jav('div.aho_ajaxsearchform input.textsearch').focus();
            }
        });

        jav(window).bind("load", function ()
        {
            header.init();
            hook_users.process();

            jav.each(['cv', 'introduction'], function (ind, item) {
                hook_users.setData(item, false);
            });
            jav.each(['title', 'org-department'], function (ind, item) {
                hook_users.setData(item, true);
            });

            jav('.wysiwyg-processed :nth-child(1)').prop('selected', 'selected').trigger('change');
        });

        //lightbox function 
        jav('.h-img').click(function () {
            var src = jav(this).attr('data-img');
            var nameimg = "<img src='" + src + "'>";
            var wrap = "<div class='wrap-image'><div>" + nameimg + "</div></div>";
            jav('.lightbox').html(wrap);
            jav('.lightbox').fadeIn(200);
            // jav('html, body').css('overflow-y', 'hidden');
        });

        jav('.lightbox').click(function () {
            jav(this).fadeOut(100);
            jav('html, body').removeAttr('style');
        });
        // max-height img lightbox
        jav('.h-img').click('live', function () {
            var maxHeight = (jav(window).height() - 200) + 'px';
            jav('.lightbox img').css('max-height', maxHeight);
        });

        //toggle cv button
        jav('.cv h2').click(function () {
            jav(".sidebar-menu-right .curriculum-button h2").not(this).removeClass('active');
            jav(".sidebar-menu-right .curriculum-button h2").not(this).next('.list').hide(200);
            jav(this).toggleClass('active');
            jav(this).next('.list').slideToggle(200);
        });

        // active menu employees list page
        jav('#employees-sf ul li a').click(function () {
            jav('#employees-sf ul li a').removeClass('active');
            jav(this).addClass('active');
            jav('#employees-sf .col-md-3 h3').removeClass('active');
            jav('#employees-sf .col-md-3 h3').removeClass('arrowActive');
            jav(this).closest('.col-md-3').find('h3').addClass('active');
            jav('#employees-sf button').removeClass('active');
            jav('#button-focus').val(jav(this).closest('.col-md-3').attr('id'));
            var a = jav('#content-bottom').offset().top;
            jav("html, body").animate({
                scrollTop: a
            }, "slow");
        });
        jav('#employees-sf button').click(function () {
            jav(this).addClass('active');
            jav('#button-focus').val('');
            jav('#employees-sf h3').removeClass('active');
            jav('#employees-sf h3').removeClass('arrowActive');
            jav('#employees-sf ul').slideUp();
            jav('#employees-sf ul li a').removeClass('active');
        });
        //toogle fillter list employees page
        jav('#employees-sf h3').click(function ()
        {
            jav('#employees-sf h3').removeClass('active');
            jav('#employees-sf h3').removeClass('arrowActive');

            // The markup for administrative units and the other menus are slightly different. So use a conditional
            // processing.
            if (jav(this).attr('id') === 'administration-unit-h3') {
                if (!jav(this).next('.item-list').children('ul').is(':visible')) {
                    jav('#employees-sf ul').slideUp();
                    jav(this).addClass('active');
                    jav(this).removeClass('arrowActive');
                    jav(this).next('h3').addClass('active');
                    jav(this).next('.item-list').find('ul').slideDown();

                    is_show = true;
                } else {
                    jav('#employees-sf ul').slideUp();
                    is_show = false;
                }
            } else {
                if (!jav(this).next('ul, .item-list ul').is(':visible')) {
                    jav('#employees-sf ul').slideUp();
                    jav(this).addClass('active');
                    jav(this).removeClass('arrowActive');
                    jav(this).next('h3').addClass('active');
                    jav(this).next('ul').slideDown();

                    is_show = true;
                } else {
                    jav('#employees-sf ul').slideUp();
                    is_show = false;
                }
            }

            if (jav('#button-focus').val() !== '')
            {
                cls = 'arrowActive';
                if (jav(this).attr('id') === jav('#button-focus').val() + '-h3')
                {
                    cls = is_show ? 'active' : 'arrowActive';
                }
                jav('#' + jav('#button-focus').val() + ' h3').addClass(cls);
            }
        });

        /*for study program*/
        // active menu
        jav('#program-sf ul li a').click(function () {
            jav('#program-sf ul li a').removeClass('active');
            jav(this).addClass('active');
            jav('#program-sf .col-md-3 h3').removeClass('active');
            jav('#program-sf .col-md-3 h3').removeClass('arrowActive');
            jav(this).closest('.col-md-3').find('h3').addClass('active');
            jav('#program-sf button').addClass('active');
            jav('#button-focus').val(jav(this).closest('.col-md-3').attr('id'));
//        var a = jav('#content-bottom').offset().top;
//        jav("html, body").animate({
//          scrollTop:a
//        },"slow");
        });
        jav('#program-sf button').click(function () {
            jav(this).removeClass('active');
            jav('#button-focus').val('');
            jav('#program-sf h3').removeClass('active');
            jav('#program-sf h3').removeClass('arrowActive');
            jav('#program-sf ul').slideUp();
            jav('#program-sf ul li a').removeClass('active');
        });

        //toogle fillter list employees page
        jav('#program-sf h3').click(function ()
        {
            jav('#program-sf h3').removeClass('active');
            jav('#program-sf h3').removeClass('arrowActive');

            if (!jav(this).next('ul').is(':visible'))
            {
                jav('#program-sf ul').slideUp();
                jav(this).addClass('active');
                jav(this).removeClass('arrowActive');
                jav(this).next('h3').addClass('active');
                jav(this).next('ul').slideDown();

                is_show = true;
            } else {
                jav('#program-sf ul').slideUp();
                is_show = false;
            }

            if (jav('#button-focus').val() !== '')
            {
                cls = 'arrowActive';
                if (jav(this).attr('id') === jav('#button-focus').val() + '-h3')
                {
                    cls = is_show ? 'active' : 'arrowActive';
                }
                jav('#' + jav('#button-focus').val() + ' h3').addClass(cls);
            }
        });
        //display page title for study program page
        /*
        var currentUrl = jQuery(location).attr('href');
        if (currentUrl.indexOf('/studier/') !== -1) {
            jav("#page-title").show();
        }*/
        
        /*end study program*/

        //check height 
        jav('#block-views-related-article-block .col-md-4 img').one('load', function ()
        {
            var type = Browser.detectBrowser();
            if (type === 0) {
                var highest = null;
                var hi = 0;
                jav("#block-views-related-article-block .col-md-4").each(function ()
                {
                    var h = jav(this).height();
                    if (h > hi)
                    {
                        hi = h;
                        highest = jav(this);
                    }
                });
                jav("#block-views-related-article-block .col-md-4 .article").height(hi);
            }
        });
        
        jav(document).ajaxStop(function ()
        {
            if (jav('#edit-identifier').length && jav('#node-panel').length)
            {
                jav('#edit-identifier').val(jav('#node-panel').val());
                jav('#override-title-checkbox').prop("checked", true);
                jav('#edit-links').prop("checked", false);
            }
        });

    });
    
//    jav(window).load(function () {
//        if (jav('.view-related-project').length){
//            var default_h = 100;
//            jav(".view-related-project .project-items .main-item").each(function () {
//                if (jav(this).height() > default_h)
//                    default_h = jav(this).height();
//            });
//            jav(".view-related-project .project-items .main-item").css({'display':'block', 'height':default_h});
//        }
//    });
        
    jav(document).ready(function () {
        if(jav('#content-bottom').length && !jav('#content-media').length){
            jav('footer').css({'margin-top':'0','border-top':'none'});
        }
        
        var type = Browser.detectBrowser();
        if (type === 1) {            
            if (jav('.node-book #block-chapter').length && jav('.col-md-8 #events-list').length) {
                var chapter = jav('.node-book #block-chapter').html();
                jav('.node-book #block-chapter').remove();
                jav('.col-md-8 #events-list').after('<div id="block-chapter">' + chapter + '</div>');
            }
        }

        jav('#oriaSearchForm .keyword').css({'width': (jav('.oria-search').width() - 260) + 'px'});
        
        if (typeof window.matchMedia != "undefined"){
            var mq = window.matchMedia("(max-width: 500px)");
            if (mq.matches) {
                var windowHeight = jav(window).height();
                var imgHeight = windowHeight - jav('header').height();
                jav('#slideshow img').height(imgHeight);
            } else {
                jav('#slideshow img').height('auto');
            }
        }
        
        

        var uroles = jQuery.base64.decode(jav('#uroles').val());
        if (uroles.indexOf('administrator') > -1 || uroles.indexOf('Administrator') > -1 || uroles.indexOf('Editor') > -1) {
            //is administrator or Editor
        } else {
            jav('#panels-ipe-control-container').remove();
        }
    });

    jav(window).resize(function () {
        if (jav('body').hasClass('closesearchform')) {
            var type = Browser.detectBrowser();
            if (type === 1)
                jav('.aho_ajaxsearchform input.textsearch').css({'width': (jav('.container').width()) + 'px'});
            else
                jav('.aho_ajaxsearchform input.textsearch').css({'width': (jav('.container').width() - 110) + 'px'});
        }
        jav('#oriaSearchForm .keyword').css({'width': (jav('.oria-search').width() - 260) + 'px'});
        if (typeof window.matchMedia != "undefined"){
            var mq = window.matchMedia("(max-width: 500px)");
            if (mq.matches) {
                var windowHeight = jav(window).height();
                var imgHeight = windowHeight - jav('header').height();
                //jav('#block-mymodule-myblock, #slideshow img').height(imgHeight);
                //console.log('imgHeight:'+imgHeight);
            } else {
                jav('#slideshow img').height('auto');
            }
        }
        
    });

    jav.fn.scrollPaginationAjax = function (options) {
        var settings = {
            type: 'people',
            nop: 3, // The number of posts per scroll to be loaded
            offset: 0, // Initial offset, begins at 0 in this case
            error: 'No More Posts!', // When the user reaches the end this is the message that is
            // displayed. You can change this if you want.
            delay: 500, // When you scroll down the posts will load after a delayed amount of time.
            // This is mainly for usability concerns. You can alter this as you see fit
            scroll: true // The main bit, if set to false posts will not load as the user scrolls. 
                    // but will still load if the user clicks.
        };

        // Extend the options so they work with the plugin
        if (options) {
            jav.extend(settings, options);
        }

        var baseUrl = jav('#baseUrl').val();
        var uriRoot = baseUrl.replace("/en", "");
        uriRoot = uriRoot.replace("/no", "");

        // For each so that we keep chainability.
        return this.each(function () {

            // Some variables 
            var javthis = jav(this);
            var javsettings = settings;
            var offset = javsettings.offset;
            var busy = false; // Checks if the scroll action is happening 
            // so we don't run it multiple times

            // Append custom messages and extra UI
            javthis.append('<div id="content-inner"></div><div class="loading-bar" style="padding:20px;text-align:center"><img style="width:32px" src="' + uriRoot + '/sites/all/themes/AHO/images/loading.gif" /></div>');

            function getData() {
                // Post data to ajax.php
                jav.post(baseUrl + "/aho-search/" + jav('.aho_ajaxsearchform input.textsearch').val() + '/' + javsettings.type, {
                    action: 'scrollpagination',
                    number: javsettings.nop,
                    offset: offset
                }, function (data) {

                    // Change loading bar content (it may have been altered)
                    javthis.find('.loading-bar').html('<img style="width:32px" src="' + uriRoot + '/sites/all/themes/AHO/images/loading.gif" />');

                    // If there is no data returned, there are no more posts to be shown. Show error
                    if (jav.trim(data) === "") {
                        javthis.find('.loading-bar').remove();
                        jav("#content-inner .content").last().css("border-bottom", "0");
                    } else {
                        // Offset increases
                        offset = offset + javsettings.nop;

                        // Append the data to the content div
                        javthis.find('#content-inner').append(data);

                        // No longer busy!	
                        busy = false;
                    }
                });
            }

            getData(); // Run function initially

            // If scrolling is enabled
            if (javsettings.scroll === true) {
                // .. and the user is scrolling
                jav(window).scroll(function () {
                    // Check the user is at the bottom of the element
                    if (busy === false) {
                        if (jav(window).scrollTop() + jav(window).height() > javthis.height()) {
                            // Now we are working, so busy is true
                            busy = true;
                            // Tell the user we're loading posts
                            javthis.find('.loading-bar').html('<img style="width:32px" src="' + uriRoot + '/sites/all/themes/AHO/images/loading.gif" />');

                            // Run the function to fetch the data inside a delay
                            // This is useful if you have content in a footer you
                            // want the user to see.
                            setTimeout(function () {
                                getData();
                            }, javsettings.delay);
                        }
                    }
                });
            }
        });
    };
    jav(document).ready(function() {
        var node_panel = jav('#node-panel').val();
        if(node_panel != 'home' || typeof(node_panel) == 'undefined') {
            var first_lang_link = jav('.language-switcher-locale-url li.first a');
            var last_lang_link = jav('.language-switcher-locale-url li.last a');
            var lang_href = first_lang_link.attr('href');
            var next_lang_href = last_lang_link.attr('href');
            var first_lang_text = first_lang_link.text();

            if(lang_href == '/no' || lang_href == 'no/' || lang_href == 'no') {
                //console.log(first_lang_text);
                first_lang_link.attr('href', next_lang_href.replace('en', first_lang_text));

            }
        }
        
        //remove hidden article in homepage
        jav('.hidden-article').each(function(){
            var tmp_node = jav(this).parent().parent();
            if (tmp_node.next().attr("class") === 'panel-separator'){
                tmp_node.next().remove();
            }
        });
        
        //for Fact box in news article
        if (jav(location).attr('href').indexOf('/nyhetsarkiv/') !== -1 || jav(location).attr('href').indexOf('/news/') !== -1){
            if (jav(window).width() >= 1024){
                if (jav("#social-box").length){
                    var heightOfTitleBox = jav(".col-md-8").find('.node-title').height();
                    var heightOfSocialBox = jav("#social-box").height();
                    var newHeight = heightOfTitleBox + 24;
                    if (newHeight > heightOfSocialBox){
                        jav("#social-box").height(newHeight);
                    }
                
                } else {
                    var heightOfTitleBox = jav(".col-md-8").find('.node-title').height();
                    var heightOfSocialBox = jav("#empty-social-box").height();
                    var newHeight = heightOfTitleBox + 24;
                    jav("#empty-social-box").height(newHeight);
                
                }
            }
        }
        
        //navigation menu: check to hide menu for study administrator and theme editor
        if (jQuery.base64.decode(jav('#uroles').val()).indexOf('Study administration editor') !== -1 
                || jQuery.base64.decode(jav('#uroles').val()).indexOf('Theme editor') !== -1) {
            jav('.navbar-menu-processed li').each(function (index,item)
            {
                if (index > 0){
                    jav(this).hide();
                }
            });
        }
        
        //correct url of link View profile on navigation bar
        //var objViewProfile = jav('#navbar-administration a:contains("View profile")');
        var objViewProfile = jav('#navbar-administration .menu .account a');
        
        //console.log(objViewProfile);
        if (typeof objViewProfile != 'undefined'){
            var loggedUsername = jav('#loggedUsername').val();
            var uid = jav('#uid').val();
            var isStudent = false;
            if(jav.base64.decode(jav('#uroles').val()).indexOf('Student') !== -1){
                isStudent = true;
            }
                
            var viewProfileUrl = objViewProfile.attr('href');
            if (viewProfileUrl){
                if (isStudent === true){
                    if (viewProfileUrl.indexOf('/no/') !== -1) {
                        var arr = viewProfileUrl.split("/no/", 2);
                        objViewProfile.attr('href',arr[0]+'/no/member/student/'+uid);
                    } else if (viewProfileUrl.indexOf('/en/') !== -1){
                        var arr = viewProfileUrl.split("/en/", 2);
                        objViewProfile.attr('href',arr[0]+'/en/member/student/'+uid);
                    } 
                } else {
                    if (viewProfileUrl.indexOf('/no/') !== -1) {
                        var arr = viewProfileUrl.split("/no/", 2);
                        objViewProfile.attr('href',arr[0]+'/no/ansatt/'+loggedUsername);
                    } else if (viewProfileUrl.indexOf('/en/') !== -1){
                        var arr = viewProfileUrl.split("/en/", 2);
                        objViewProfile.attr('href',arr[0]+'/en/aho-staff/'+loggedUsername);
                    } 
                }
                
            }
        }
        
        
    });
})(jQuery);

(function ($) {
  Drupal.behaviors.aho_book_accordion_form_toggler = {
    attach: function (context, settings) {
      $('.node-book .field-name-field-frequently-used-forms .field-label').on('click', function() {
        $('.node-book .field-name-field-frequently-used-forms .field-items').slideToggle('slow', function() {
          $('.node-book .field-name-field-frequently-used-forms').toggleClass('collapsed', $('.node-book .field-name-field-frequently-used-forms .field-items').is(':hidden'));
        });
      });
    }
  };

  Drupal.behaviors.aho_gdpr = {
    attach: function (context, settings) {
      // Triggers the accept action of the cookie compliance module, when clicking a link in the popup.
      // The module's option is not sufficient, because it reacts on links and buttons across the whole page.
      // Take care, that you need to remove this, when changing the consent type.
      if (typeof Drupal.eu_cookie_compliance !== 'undefined') {
        $('body').on('click', '.popup-content a', Drupal.eu_cookie_compliance.acceptAction);
      }
    }
  };

  Drupal.behaviors.aho_responsive_imagemaps = {
    attach: function (context, settings) {
      $('.field-name-body img[usemap]').rwdImageMaps();
    }
  };

}(jQuery));
